话说，我曾经做过数据库开发，这不好久没用，都生疏了。近来需要用到sqlite做一些简单的数据管理，所以赶紧的，回顾下曾经运用过的数据库知识，捡点回来吧。

#### 表结构设计

对于关系型数据库，表结构的设计应当巧妙地利用外键来为表之间建立联系，通过这种联系可以很好的组织数据存放，也方便获取。总结下，表结构的设计有以下几个原则(纯属个人想法)：
* 共用的数据不要分散在多个表，而要集中在同一个表里，通过关联去读写，可以避免冗余
* 数据库结构设计时，应避免让某一个表或某几个表的数据量过大，尽量将数据分布均衡些
* 对于数据量较大的表，字段尽量少，并设置相应的索引
* 重要的表都应当有预留字段
* 非英文、非数字的字符串类型，应当选用NVarchar类型（如：中文）

#### SQL查询语句

基于`SQL Server`的开发经验，总结以下几点，可让查询语句效率更高：
* 有索引的字段应当优先被检索，如下例子，假如表table_1的字段rowid与table_2的字段parent_id有索引，而这两个表的count字段均无索引，则`a.rowid = b.parent_id`应当在前，`a.count < b.count`在后。原因是这样的，如果检索的字段有索引，则不需要扫描整个表，所以先检索有索引的字段，就是先一步减小查询结果的数据量，之后再检索`a.count < b.count`，其扫描的数据量一定不大于整个表。
```sql
Select *
From   table_1 a, table_2 b
Where  a.rowid = b.parent_id and a.count < b.count
```

* 三个表或更多个表同时进行关联查询时，尽量使用`Join`（如：`Inner Join`、`Left Join`）而不用`Where`，因为`Where`是先对所有表求笛卡儿积后再做过滤，而`Join`是对两个表求笛卡儿积后立即根据条件进行过滤，再将过滤结果与第三个表进行关联查询。

* 尽量避免`Select *`，即尽量避免查询所有的字段作为结果，因为查询结果的字段越多，则需要消耗越多的资源，所以只要把需要用到的字段查出来即可。

* 当查询结果需要排序时，只对最终的结果进行排序即可，不需要在子查询语句中进行排序，因为子查询语句是否排序并不影响最终结果，只会白白消耗资源。

#### 实例

一直记得这么一个例子：只用一个SQL语句将下面第一个表格的数据转化成第二个表格的格式

|姓名|性别|选修科目|
|--|--|--|
|张三|男|乒乓球|
|张三|男|拉丁舞|
|张三|男|田径|
|陈韵|女|瑜伽|
|陈韵|女|毽球|
|李四|男|排球|
|李四|男|羽毛球|

|姓名|性别|选修科目|
|--|--|--|
|张三|男|乒乓球,拉丁舞,田径|
|陈韵|女|瑜伽,毽球|
|李四|男|排球,羽毛球|

下面是SQL语句示例

```sql
Select c.name, c.sex, Left(c.subjects, Len(c.subjects - 1)) AS subjects
From   (Select  b.name, (Select subject + ','
                         From   table_name
                         Where  name = b.name
                         For XML Path('')) AS subjects, b.sex
        From   table_name b
        Group  By b.name, b.sex) c
```
